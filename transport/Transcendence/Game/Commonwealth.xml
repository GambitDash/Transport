<?xml version="1.0" encoding="utf-8"?>

<TranscendenceModule>

	<!-- Commonwealth Colony -->

	<StationType UNID="&stCommonwealthColony;"
			name=				"(commonwealth colony)"
			sovereign=			"&svCommonwealth;"
			dockScreen=			"Main"
			abandonedScreen=	"&dsAbandonedStation;"
			dockingPorts=		"8"
			canAttack=			"true"

			multiHull=			"true"
			armorID=			"&itPlasteelPlate;"
			maxHitPoints=		"100"
			hitPoints=			"100"
			repairRate=			"1"
			shipRepairRate=		"1"
			explosionType=		"&vtBlastExplosion3;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"commonwealth,friendly,primary,populated"
			levelFrequency=		"cuc-- ----- ----- ----- -----"
			locationCriteria=	"+planetary,-OuterSystem"

			noArticle=			"true"
			>

		<Names>Agricola Station; Britannia Station; Canterbury Station;
				Devonshire Colony; Enterprise Station; Farsend Station;
				Grenoble Colony; Hellas Station; Independence Station;
				Janus Colony; Koran Station; Lexington Colony; Massachusetts Colony;
				Nakura Colony; Ontario Station; Paduan Station; Qatar Station;
				Ryad Colony; Santiago Station; Tango Colony; Umber Station;
				Victory Colony; Winchell Station; %s Colony; %s Alpha Station;
				%s Beta Station; %s Gamma Station; %s Epsilon Station;
				Anacreon Colony %1%0%0%0; Anacreon Colony %1%0%0; Anacreon Colony %1%0%0;
				Anacreon Colony %1%0%0; Anacreon Colony %1%0%0</Names>
		
		<Image			imageID="&rsStations1;" imageX="0" imageY="256" imageWidth="128" imageHeight="128"/>

		<Devices>
			<Device deviceID="&itTeV9Blaster;"	omnidirectional="true"/>
		</Devices>

		<Items>
			<RandomItem count="10" 
					criteria=		"ad -Illegal; -Military; -Alien; -Specialty; -NotForSale;"
					level=			"2"
					levelCurve=		"1"
					/>
			<RandomItem count="10" 
					criteria=		"* -Illegal; -Military; -Alien; -Specialty; -NotForSale;"
					level=			"2"
					levelCurve=		"1"
					/>
			<RandomItem count="3" 
					criteria=		"* -Illegal; -Military; -Alien; -Specialty; -NotForSale;"
					level=			"3"
					levelCurve=		"1"
					/>

			<Item count="4d12"	item="&itHelium3FuelRod;" />
		</Items>

		<Trade currency="credit" creditConversion="100" max="50000" replenish="2500">
			<Sell	criteria="*NU -Illegal; -ID; -NotForSale;"	priceAdj="110"/>
			<Buy	criteria="amswNU -Illegal; -NotForSale;"		priceAdj="50"/>
			<Buy	criteria="*NU -Illegal; -ID; -NotForSale;"	priceAdj="90"/>
			<Buy	criteria="*NU -Illegal; -ID;"				priceAdj="10"/>
		</Trade>

		<Ships>
			<Table count="2">
				<Ship chance="50" count="1" class="&scEI100M;" orders="guard"/>
				<Ship chance="30" count="1" class="&scRoninB;" orders="guard"/>
				<Ship chance="20" count="1" class="&scBorer-II;" orders="guard"/>
			</Table>

			<Table count="1d4">
				<Ship chance="50" count="1" class="&scEI100;" orders="gateOnThreat"/>
				<Ship chance="20" count="1" class="&scSapphireYacht;" orders="gateOnThreat"/>
				<Ship chance="20" count="1" class="&scBorer;" orders="gateOnThreat"/>
				<Ship chance="10" count="1" class="&scRoninC;" orders="guard"/>
			</Table>
		</Ships>

		<Reinforcements minShips="5">
			<Table>
				<Ship chance="25" count="1" class="&scEI100;" orders="gateOnThreat"/>
				<Ship chance="10" count="1" class="&scSapphireYacht;" orders="gateOnThreat"/>
				<Ship chance="15" count="1" class="&scBorer;" orders="gateOnThreat"/>
				<Ship chance="25" count="1" class="&scRoninB;" orders="guard"/>
				<Ship chance="25" count="1" class="&scRoninC;" orders="guard"/>
			</Table>
		</Reinforcements>

		<Events>
			<OnContractGenerate>
				(intGenerateStandardRequestContract1)
			</OnContractGenerate>

			<OnContractQuery>True</OnContractQuery>

			<OnDestroy>
				(intCommonwealthOnDestroy)
			</OnDestroy>
		</Events>

		<DockScreens>
			<Main
				name=			"=(objGetName gSource)"
				>

				<OnInit>
					(intCommonwealthOnInit "Main")
				</OnInit>

				<Panes>
					<Default
							desc=	"You are in the docking bay of a Commonwealth colony. Except for a few shuttles, the docking bay of this station is deserted. A loose hose is spilling dirty water onto the landing pad; elsewhere, an automatic load-lifter moves forward and back again as it unloads a ship's cargo hold. The air smells of liquid fuel and exhaust.">

						<Actions>
							<Action name="Commodities Exchange" default="1" key="C">
								<ShowPane pane="CommoditiesExchange"/>
							</Action>

							<Action name="Dock Services" key="D">
								<ShowPane pane="DockServices"/>
							</Action>

							<Action name="Undock" cancel="1" key="U">
								<Exit/>
							</Action>

						</Actions>

					</Default>

					<CommoditiesExchange>

						<Initialize>
							(scrSetDesc gScreen (cat "Welcome to the " (objGetName gSource) " Commodities Exchange Market."))
						</Initialize>

						<Actions>
							<Action name="Buy items" default="1" key="B">
								(block Nil
									(setq gPrevScreen "Main")
									(setq gMargin Nil)
									(setq gInstallCriteria Nil)
									(scrShowScreen gScreen "&dsExchangeBuy;")
									)
							</Action>

							<Action name="Sell items" key="S">
								(block Nil
									(setq gPrevScreen "Main")
									(setq gMargin Nil)
									(setq gTitle Nil)
									(scrShowScreen gScreen "&dsExchangeSell;")
									)
							</Action>

							<Action name="Done" cancel="1" key="D">
								<ShowPane pane="Default"/>
							</Action>

						</Actions>

					</CommoditiesExchange>

					<DockServices
							desc=	"You are at the docking services terminal.">

						<Actions>
							<Action name="Refuel" key="R">
								(block Nil
									(setq gPrevScreen "Main")
									(setq gPrevPane "DockServices")
									(intSetCompatibleFuel '((&itHeliumAssembly; 70) (&itHelium3FuelRod; 22)))
									(scrShowScreen gScreen "&dsRefuel;")
									)
							</Action>

							<Action name="Repair or replace armor" key="A" >
								(block Nil
									(setq gPrevScreen "Main")
									(setq gPrevPane "DockServices")
									(setq gTechLevel 5)
									(setq gArmorSegment 0)
									(setq gMargin 100)
									(scrShowScreen gScreen "&dsRepairArmor;")
									)
							</Action>

							<Action name="Done" cancel="1" key="D">
								<ShowPane pane="Default"/>
							</Action>

						</Actions>

					</DockServices>

				</Panes>
			</Main>

		</DockScreens>

		<DockingPorts>
			<Port x="0"		y="90" />
			<Port x="0"		y="-90" />
			<Port x="60"	y="60" />
			<Port x="60"	y="-60" />
			<Port x="90"	y="0" />
			<Port x="-90"	y="0" />
			<Port x="-60"	y="60" />
			<Port x="-60"	y="-60" />
		</DockingPorts>

		</StationType>

	<!-- Commonwealth Turret -->

	<StationType UNID="&stCommonwealthTurret;"
			name=				"Commonwealth Defense Turret"
			sovereign=			"&svCommonwealth;"
			abandonedScreen=	"&dsAbandonedStation;"
			dockScreen=			"Main"
			dockingPorts=		"4"
			noMapLabel=			"true"
			noFriendlyFire=		"true"
			canAttack=			"true"

			mass=				"2000"
			armorID=			"&itP120HexphaseArmor;"
			maxHitPoints=		"100"
			maxStructuralHitPoints="20"
			fireRateAdj=		"40"
			ejectaType=			"&vtWreckEjecta;"
			>

		<ImageVariants>
			<Image			imageID="&rsStations4;" imageX="96" imageY="320" imageWidth="32" imageHeight="32"/>
			<Image			imageID="&rsStations4;" imageX="96" imageY="352" imageWidth="32" imageHeight="32"/>
			<Image			imageID="&rsStations4;" imageX="96" imageY="384" imageWidth="32" imageHeight="32"/>
			<Image			imageID="&rsStations4;" imageX="96" imageY="416" imageWidth="32" imageHeight="32"/>
		</ImageVariants>

		<Devices>
			<Device deviceID="&itTeV9Blaster;"	omnidirectional="true"/>
		</Devices>

		<DockScreens>
			<Main
				name=			"=(objGetName gSource)"
				>

				<Panes>
					<Default
							desc=	"You are docked at a Commonwealth Defense Turret. These armed and armored turrets are used to defend Commonwealth stations and settlements in the Ungoverned territory beyond St. Katharine's Star System.">

						<Actions>
							<Action name="Undock" cancel="1" key="U">
								<Exit/>
							</Action>

						</Actions>

					</Default>
				</Panes>
			</Main>
		</DockScreens>

		<DockingPorts>
			<Port x="0"		y="24" />
			<Port x="0"		y="-24" />
			<Port x="24"	y="0" />
			<Port x="-24"	y="0" />
		</DockingPorts>

	</StationType>

	<!-- Commonwealth Colony, Armed -->

	<StationType UNID="&stCommonwealthColonyArmed;"
			name=				"(commonwealth colony, armed)"
			sovereign=			"&svCommonwealth;"
			dockScreen=			"Main"
			abandonedScreen=	"&dsAbandonedStation;"
			dockingPorts=		"8"
			canAttack=			"true"

			multiHull=			"true"
			armorID=			"&itP120HexphaseArmor;"
			maxHitPoints=		"250"
			hitPoints=			"250"
			repairRate=			"1"
			shipRepairRate=		"1"
			fireRateAdj=		"40"
			explosionType=		"&vtThermoExplosion1;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"commonwealth,fleetDelivery,friendly,primary,populated"
			levelFrequency=		"---uu cu--- ----- ----- -----"
			locationCriteria=	"+planetary"

			noArticle=			"true"
			>

		<Names>Anvil Station; Brimstone Station; Cerberus Station;
				Demesne Colony; Exile Station; Farsend Station;
				Greenspace Colony; Hellas Station; Independence Station;
				Jotur Colony; C%1%0 Outpost; Lethe Colony; Mars Colony;
				Nebulon Colony; Oort Station; Purgatory Station; Quequeg Station;
				Rend Colony; Sangre Station; Tantalus Colony; Umber Station;
				Vindication Colony; Wight Station; %s Colony; %s Alpha Station;
				%s Beta Station; %s Gamma Station; %s Epsilon Station</Names>
		
		<Image			imageID="&rsStations1;" imageX="0" imageY="256" imageWidth="128" imageHeight="128"/>

		<Devices>
			<Device deviceID="&itTeV9Blaster;"	omnidirectional="true"/>
		</Devices>

		<Items>
			<RandomItem count="10" 
					criteria=		"ad -Illegal; -Military; -Alien; -Specialty; -NotForSale;"
					level=			"6"
					levelCurve=		"1"
					/>
			<RandomItem count="10" 
					criteria=		"* -Illegal; -Military; -Alien; -Specialty; -NotForSale;"
					level=			"6"
					levelCurve=		"2"
					/>
			<RandomItem count="3" 
					criteria=		"* -Illegal; -Military; -Alien; -Specialty; -NotForSale;"
					level=			"5"
					levelCurve=		"1"
					/>

			<Item count="4d12"	item="&itXenotiteFuelRod;" />
		</Items>

		<Trade currency="credit" creditConversion="100" max="50000" replenish="2500">
			<Sell	criteria="*NU -Illegal; -ID; -NotForSale;"	priceAdj="110"/>
			<Buy	criteria="amswNU -Illegal; -NotForSale;"		priceAdj="50"/>
			<Buy	criteria="*NU -Illegal; -ID; -NotForSale;"	priceAdj="90"/>
			<Buy	criteria="*NU -Illegal; -ID;"				priceAdj="10"/>
		</Trade>

		<Ships>
			<Table count="2">
				<Ship chance="50" count="1" class="&scEI100M;" orders="guard"/>
				<Ship chance="30" count="1" class="&scRoninC;" orders="guard"/>
				<Ship chance="20" count="1" class="&scCenturion;" orders="guard"/>
			</Table>

			<Table count="1d4">
				<Ship chance="50" count="1" class="&scEI500;" orders="gateOnThreat"/>
				<Ship chance="20" count="1" class="&scSapphireYacht;" orders="gateOnThreat"/>
				<Ship chance="20" count="1" class="&scWolfen;" orders="gateOnThreat"/>
				<Ship chance="10" count="1" class="&scCenturion;" orders="guard"/>
			</Table>
		</Ships>

		<Reinforcements minShips="5">
			<Table>
				<Ship chance="50" count="1" class="&scRoninC;" orders="guard"/>
				<Ship chance="50" count="1" class="&scCenturion;" orders="guard"/>
			</Table>
		</Reinforcements>

		<Satellites>
			<Orbitals distance="7" angle="45">
				<Station type="&stCommonwealthTurret;" imageVariant="2"/>
			</Orbitals>

			<Orbitals distance="7" angle="135">
				<Station type="&stCommonwealthTurret;" imageVariant="1"/>
			</Orbitals>

			<Orbitals distance="7" angle="225">
				<Station type="&stCommonwealthTurret;" imageVariant="0"/>
			</Orbitals>

			<Orbitals distance="7" angle="315">
				<Station type="&stCommonwealthTurret;" imageVariant="3"/>
			</Orbitals>
		</Satellites>

		<Events>
			<OnContractGenerate>
				(intGenerateStandardRequestContract1)
			</OnContractGenerate>

			<OnContractQuery>True</OnContractQuery>

			<OnDestroy>
				(intCommonwealthOnDestroy)
			</OnDestroy>
		</Events>

		<DockScreens>
			<Main
				name=			"=(objGetName gSource)"
				>

				<OnInit>
					(intCommonwealthOnInit "Main")
				</OnInit>

				<Panes>
					<Default
							desc=	"You are in the docking bay of a Commonwealth colony. Except for a few shuttles, the docking bay of this station is deserted. A loose hose is spilling dirty water onto the landing pad; elsewhere, an automatic load-lifter moves forward and back again as it unloads a ship's cargo hold. The air smells of liquid fuel and exhaust.">

						<Actions>
							<Action name="Commodities Exchange" default="1" key="C">
								<ShowPane pane="CommoditiesExchange"/>
							</Action>

							<Action name="Dock Services" key="D">
								<ShowPane pane="DockServices"/>
							</Action>

							<Action name="Undock" cancel="1" key="U">
								<Exit/>
							</Action>

						</Actions>

					</Default>

					<CommoditiesExchange>

						<Initialize>
							(scrSetDesc gScreen (cat "Welcome to the " (objGetName gSource) " Commodities Exchange Market."))
						</Initialize>

						<Actions>
							<Action name="Buy items" default="1" key="B">
								(block Nil
									(setq gPrevScreen "Main")
									(setq gMargin Nil)
									(setq gInstallCriteria Nil)
									(scrShowScreen gScreen "&dsExchangeBuy;")
									)
							</Action>

							<Action name="Sell items" key="S">
								(block Nil
									(setq gPrevScreen "Main")
									(setq gMargin Nil)
									(setq gTitle Nil)
									(scrShowScreen gScreen "&dsExchangeSell;")
									)
							</Action>

							<Action name="Done" cancel="1" key="D">
								<ShowPane pane="Default"/>
							</Action>

						</Actions>

					</CommoditiesExchange>

					<DockServices
							desc=	"You are at the docking services terminal.">

						<Actions>
							<Action name="Refuel" key="R">
								(block Nil
									(setq gPrevScreen "Main")
									(setq gPrevPane "DockServices")
									(intSetCompatibleFuel '((&itXenotiteFuelRod; 150) (&itHeliumAssembly; 70) (&itHelium3FuelRod; 22)))
									(scrShowScreen gScreen "&dsRefuel;")
									)
							</Action>

							<Action name="Repair or replace armor" key="A" >
								(block Nil
									(setq gPrevScreen "Main")
									(setq gPrevPane "DockServices")
									(setq gTechLevel 7)
									(setq gArmorSegment 0)
									(setq gMargin 100)
									(scrShowScreen gScreen "&dsRepairArmor;")
									)
							</Action>

							<Action name="Done" cancel="1" key="D">
								<ShowPane pane="Default"/>
							</Action>

						</Actions>

					</DockServices>

				</Panes>
			</Main>

		</DockScreens>

		<DockingPorts>
			<Port x="0"		y="90" />
			<Port x="0"		y="-90" />
			<Port x="60"	y="60" />
			<Port x="60"	y="-60" />
			<Port x="90"	y="0" />
			<Port x="-90"	y="0" />
			<Port x="-60"	y="60" />
			<Port x="-60"	y="-60" />
		</DockingPorts>

	</StationType>
		
	<!-- Commonwealth Dry Dock -->

	<StationType UNID="&stCommonwealthDryDock;"
			name=				"Commonwealth Dry Dock"
			sovereign=			"&svCommonwealth;"
			dockScreen=			"&dsDryDock;"
			abandonedScreen=	"&dsAbandonedStation;"
			canAttack=			"true"

			multiHull=			"true"
			armorID=			"&itPlasteelPlate;"
			maxHitPoints=		"250"
			hitPoints=			"250"
			repairRate=			"2"
			shipRepairRate=		"3"
			explosionType=		"&vtThermoExplosion1;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"commonwealth,fleetDelivery,friendly,populated"
			levelFrequency=		"uucuu r---- ----- ----- -----"
			locationCriteria=	"-asteroids"
			>

		<Image			imageID="&rsStations1;" imageX="256" imageY="0" imageWidth="224" imageHeight="224"/>

		<Ships>
			<Ship					count="1d2" class="&scRoninC;" orders="guard"/>
			<Table count="1d2">
				<Ship chance="20"	count="1" class="&scEI100;" orders="gateOnThreat" />
				<Ship chance="20"	count="1" class="&scEI500;" orders="gateOnThreat" />
				<Ship chance="25"	count="1" class="&scBorer;" orders="gateOnThreat"/>
				<Ship chance="15"	count="1" class="&scSapphireYacht;" orders="gateOnThreat"/>
				<Ship chance="10"	count="1" class="&scWolfen;" orders="gateOnThreat" />
				<Ship chance="10"	count="1" class="&scCenturion;" orders="guard"/>
			</Table>
		</Ships>

		<Reinforcements minShips="5">
			<Table>
				<Ship chance="15" count="1" class="&scEI500;" orders="gateOnThreat"/>
				<Ship chance="10" count="1" class="&scEI100;" orders="gateOnThreat"/>
				<Ship chance="10" count="1" class="&scWolfen;" orders="gateOnThreat"/>
				<Ship chance="15" count="1" class="&scRoninC;" orders="guard"/>
				<Ship chance="50" count="1" class="&scCenturion;" orders="guard"/>
			</Table>
		</Reinforcements>

		<Events>
			<OnContractGenerate>
				(intGenerateIndustrialRequestContract1)
			</OnContractGenerate>

			<OnContractQuery>True</OnContractQuery>

			<OnDestroy>
				(intCommonwealthOnDestroy)
			</OnDestroy>
		</Events>

		<DockingPorts>
			<Port x="0"		y="100" />
			<Port x="-80"	y="40" />
			<Port x="80"	y="40" />
			<Port x="-60"	y="-40" />
			<Port x="60"	y="-40" />

			<Port x="0"		y="-105" />
			<Port x="-130"	y="-17" />
			<Port x="130"	y="-17" />
			<Port x="-70"	y="105" />
			<Port x="70"	y="105" />
		</DockingPorts>

	</StationType>

	<!-- Commonwealth Medical Suburb -->

	<StationType UNID="&stMedicalSuburb;"
			name=				"(medical suburb)"
			sovereign=			"&svCommonwealth;"
			dockScreen=			"Main"
			abandonedScreen=	"&dsAbandonedStation;"
			dockingPorts=		"8"
			canAttack=			"true"

			multiHull=			"true"
			armorID=			"&itPlasteelPlate;"
			maxHitPoints=		"100"
			hitPoints=			"100"
			repairRate=			"1"
			shipRepairRate=		"1"
			explosionType=		"&vtBlastExplosion3;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"commonwealth,friendly,populated"
			levelFrequency=		"uuurr ----- ----- ----- -----"
			locationCriteria=	"+planetary,-OuterSystem"

			noArticle=			"true"
			>

		<Names>Asclepius Station; Barnard Station; Station Charity; 
				Crick Station; Drew Station; Station Empathy; Freud Complex;
				Station Grace; Haeckel Station; Imhotep Station;
				Jung Center; Koch Station; Leeuwenhoek Station;
				Morton Station; Nicolle Station; Osler Station;
				Penfield Station; Station Respite; Salk Station;
				Taussig Station; Urbani Station; Virchow Station;
				Watson Station; Yegerov Station; Zygote Station;
				Cyteen Station; NeuroSci Station; Biogen Station;
				Pharmaton %s; Medecin d'Etoile Station</Names>
		
		<Image			imageID="&rsStations1;" imageX="0" imageY="256" imageWidth="128" imageHeight="128"/>

		<Devices>
			<Device deviceID="&itTeV9Blaster;"	omnidirectional="true"/>
		</Devices>

		<Items>
			<RandomItem count="10" 
					criteria=		"* +Meds; -Illegal; -Military; -Alien; -NotForSale;"
					level=			"3"
					levelCurve=		"2"
					/>
			<RandomItem count="5" 
					criteria=		"* +Meds; -Illegal; -Military; -Alien; -NotForSale;"
					level=			"2"
					levelCurve=		"1"
					/>
		</Items>

		<Trade currency="credit" creditConversion="100" max="50000" replenish="2500">
			<Sell	criteria="*NU +Meds; -Illegal; -ID; -NotForSale;"	priceAdj="110"/>
			<Buy	criteria="*NU +Food; -Illegal;"	priceAdj="110"/>
			<Buy	criteria="*NU +Lux; -Illegal;"	priceAdj="120"/>
		</Trade>

		<Ships>
			<Table count="2">
				<Ship chance="50" count="1" class="&scEI100M;" orders="guard"/>
				<Ship chance="30" count="1" class="&scRoninB;" orders="guard"/>
				<Ship chance="20" count="1" class="&scBorer-II;" orders="guard"/>
			</Table>

			<Table count="1d4">
				<Ship chance="50" count="1" class="&scEI100;" orders="gateOnThreat"/>
				<Ship chance="20" count="1" class="&scSapphireYacht;" orders="gateOnThreat"/>
				<Ship chance="20" count="1" class="&scBorer;" orders="gateOnThreat"/>
				<Ship chance="10" count="1" class="&scRoninC;" orders="guard"/>
			</Table>
		</Ships>

		<Reinforcements minShips="5">
			<Table>
				<Ship chance="25" count="1" class="&scEI100;" orders="gateOnThreat"/>
				<Ship chance="10" count="1" class="&scSapphireYacht;" orders="gateOnThreat"/>
				<Ship chance="15" count="1" class="&scBorer;" orders="gateOnThreat"/>
				<Ship chance="25" count="1" class="&scRoninB;" orders="guard"/>
				<Ship chance="25" count="1" class="&scRoninC;" orders="guard"/>
			</Table>
		</Reinforcements>

		<Events>
			<OnContractGenerate>
				(intGenerateStandardRequestContract1)
			</OnContractGenerate>

			<OnContractQuery>True</OnContractQuery>

			<OnDestroy>
				(intCommonwealthOnDestroy)
			</OnDestroy>
		</Events>

		<DockScreens>
			<Main
				name=			"=(objGetName gSource)"
				>

				<OnInit>
					(intCommonwealthOnInit "Main")
				</OnInit>

				<Panes>
					<Default>
						<Initialize>
							(scrSetDesc gScreen (cat
								"You are in the docking bay of " (objGetName gSource) ". Medical professionals live and work on this station, doing everything from research, to drug manufacturing, to remote medicine."
								))
						</Initialize>

						<Actions>
							<Action name="Commodities Exchange" default="1" key="C">
								<ShowPane pane="CommoditiesExchange"/>
							</Action>

							<Action name="Undock" cancel="1" key="U">
								<Exit/>
							</Action>

						</Actions>

					</Default>

					<CommoditiesExchange>

						<Initialize>
							(scrSetDesc gScreen (cat "Welcome to the " (objGetName gSource) " Commodities Exchange Market."))
						</Initialize>

						<Actions>
							<Action name="Buy items" default="1" key="B">
								(block Nil
									(setq gPrevScreen "Main")
									(setq gMargin Nil)
									(setq gInstallCriteria Nil)
									(scrShowScreen gScreen "&dsExchangeBuy;")
									)
							</Action>

							<Action name="Sell items" key="S">
								(block Nil
									(setq gPrevScreen "Main")
									(setq gMargin Nil)
									(setq gTitle Nil)
									(scrShowScreen gScreen "&dsExchangeSell;")
									)
							</Action>

							<Action name="Done" cancel="1" key="D">
								<ShowPane pane="Default"/>
							</Action>

						</Actions>

					</CommoditiesExchange>

				</Panes>
			</Main>

		</DockScreens>

		<DockingPorts>
			<Port x="0"		y="90" />
			<Port x="0"		y="-90" />
			<Port x="60"	y="60" />
			<Port x="60"	y="-60" />
			<Port x="90"	y="0" />
			<Port x="-90"	y="0" />
			<Port x="-60"	y="60" />
			<Port x="-60"	y="-60" />
		</DockingPorts>

		</StationType>

	<!-- Commonwealth Residentials -->

	<StationType UNID="&stCommonwealthResidentials;"
			name=				"Commonwealth Residentials"
			sovereign=			"&svCommonwealth;"
			dockScreen=			"Main"
			abandonedScreen=	"&dsAbandonedStation;"
			dockingPorts=		"8"
			canAttack=			"true"

			multiHull=			"true"
			armorID=			"&itPlasteelPlate;"
			maxHitPoints=		"250"
			hitPoints=			"250"
			repairRate=			"1"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"commonwealth,friendly,populated"
			
			noArticle=			"true"
			>

		<Image			imageID="&rsStations1;" imageX="0" imageY="256" imageWidth="128" imageHeight="128"/>

		<Ships>
			<Table count="1d4+2">
				<Ship chance="50" count="1" class="&scEI100;"/>
				<Ship chance="25" count="1" class="&scSapphireYacht;"/>
				<Ship chance="25" count="1" class="&scBorer;"/>
			</Table>
		</Ships>

		<Events>
			<OnContractGenerate>
				(intGenerateStandardRequestContract1)
			</OnContractGenerate>

			<OnContractQuery>True</OnContractQuery>

			<OnDestroy>
				(intCommonwealthOnDestroy)
			</OnDestroy>
		</Events>			

		<DockScreens>
			<Main
				name=			"=(objGetName gSource)"
				>

				<OnInit>
					(intCommonwealthOnInit "Main")
					</OnInit>
					
				<Panes>
					<Default
							desc=	"Welcome to Commonwealth Residentials.">

						<Actions>
							<Action name="Undock" cancel="1" key="U">
								<Exit/>
							</Action>

						</Actions>

					</Default>
				</Panes>
			</Main>

		</DockScreens>

		<DockingPorts>
			<Port x="0"		y="90" />
			<Port x="0"		y="-90" />
			<Port x="60"	y="60" />
			<Port x="60"	y="-60" />
			<Port x="90"	y="0" />
			<Port x="-90"	y="0" />
			<Port x="-60"	y="60" />
			<Port x="-60"	y="-60" />
		</DockingPorts>

	</StationType>

	<!-- Commonwealth Slums

	GLOBAL DATA

	lastMissionTime:	Tick on which mission was given to player (Nil if never)
	missionInProgress:	True if a mission is in progress (on some station)
	totalMissionCount:	Total number of missions that the player has requested

	EXTRA DATA

	missionStatus:		Status of mission:
							Nil						= no mission in progress
							'inprogress				= mission in progress
							'success				= mission accomplished
							'failure				= mission failed

	missionFee:			Reward on mission success
	target:				Station to destroy
	
	-->

	<StationType UNID="&stCommonwealthSlums;"
			name=				"(commonwealth habitat)"
			sovereign=			"&svCommonwealth;"
			dockScreen=			"Main"
			abandonedScreen=	"&dsAbandonedStation;"
			canAttack=			"true"

			multiHull=			"true"
			armorID=			"&itPlasteelPlate;"
			maxHitPoints=		"150"
			hitPoints=			"150"
			repairRate=			"1"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"commonwealth,friendly,populated"
			level=				"1"

			noArticle=			"true"
			>

		<Names>Habitat Alpha %1%0; Habitat Beta %1%0; Habitat Gamma %1%0; Habitat Delta %1%0;
				Habitat Epsilon %1%0; Habitat Zeta %1%0</Names>

		<ImageVariants>
			<Image	imageID="&rsCommonwealthSlumsImage;" imageX="0" imageY="0" imageWidth="64" imageHeight="128"/>
			<Image	imageID="&rsCommonwealthSlumsImage;" imageX="64" imageY="0" imageWidth="64" imageHeight="128"/>
			<Image	imageID="&rsCommonwealthSlumsImage;" imageX="128" imageY="0" imageWidth="64" imageHeight="128"/>
			<Image	imageID="&rsCommonwealthSlumsImage;" imageX="192" imageY="0" imageWidth="64" imageHeight="128"/>
		</ImageVariants>

		<Ships>
			<Table count="1d4">
				<Ship chance="50" count="1" class="&scEI100;"/>
				<Ship chance="25" count="1" class="&scSapphireYacht;"/>
				<Ship chance="25" count="1" class="&scBorer;"/>
			</Table>
		</Ships>
		
		<StaticData>
			<Rumors>
				(
					"\"You got a pretty nice ship there. Did your mom and dad buy it for you?\""
					"\"Truth is, you gotta approach life philosophically, you know what I mean? You gotta believe that it's all going to work out in the end, or else what's the point?\""
					"\"Nobody cares. Station needs a carbon scrubber? Get on the waiting list! After the corporate suits get their grilled Icelandic salmon, then they might pay attention to you. Nobody cares.\""
					"\"The warlords are annoying, but they don't mean much. The only one that bothers me is Arco Vaughn. He's trouble. Someone ought to air him out before things get out of hand, you know?\""
					"\"I don't know what you're doing in this backwater system. You wanna get to the Core? Go! What's stopping you? Kids today: they dream big, but they'd rather watch the 3DVs.\""
					"\"It's sad about Raisu station, isn't it? If a corporate fuel station got taken over by Centauri warlords they'd have Admiral Decker himself leading the rescue. But no one cares about a poor, backwater station, I guess.\""
					"\"If you're looking for Arco Vaughn, go to Raisu station: the station master there will help you out. But first you gotta convince her that you're serious.\""
					"\"If you need help against Arco Vaughn the station master at Raisu station will help you. But you'll have to prove that you're serious. Take out a few Centauri stations and you might convince her.\""
					)
			</Rumors>
		</StaticData>

		<Events>
			<OnContractGenerate>
				(intGenerateStandardRequestContract1)
			</OnContractGenerate>

			<OnContractQuery>True</OnContractQuery>

			<OnDestroy>
				(intCommonwealthOnDestroy)
			</OnDestroy>
			
			<OnObjDestroyed>
				(switch
					(and (eq aObjDestroyed (objGetObjRefData gSource "target"))
							(eq (objGetData gSource "missionStatus") 'inprogress))
						(block Nil
							(objSetData gSource "missionStatus" 'success)
							(objUnregisterForEvents gSource aObjDestroyed)
							(shpCancelOrders gPlayerShip)
							(shpOrder gPlayerShip 'dock gSource)
							(plyMessage gPlayer "Mission complete!")
							)
					)
			</OnObjDestroyed>
		</Events>

		<DockScreens>
			<Main
				name=			"=(objGetName gSource)"
				>

				<OnInit>
					(intCommonwealthOnInit "Main")
				</OnInit>
				
				<InitialPane>
					(block (missionStatus)
						(setq missionStatus (objGetData gSource "missionStatus"))

						(switch
							; If no mission, then normal screen
							(not missionStatus)
								"Default"

							; See if player has destroyed target
							(eq missionStatus 'success)
								"MissionSuccess"

							"MissionInProgress"
							)
						)
				</InitialPane>
					
				<Panes>
					<Default>

						<Initialize>
							(scrSetDesc gScreen (cat
								"The loud voices of a packed multitude bounce off every bulkhead and corridor in the station. "
								"Old air scrubbers pump a thin, odorous breeze out of rusty vents. Discarded packets of Salmonite and Red Nebula beer huddle in the corner.\n\n"
								"Welcome to " (objGetName gSource) "!"
								))
						</Initialize>

						<Actions>
							<Action name="Meeting Hall" key="M" default="1">
								(block (lastMissionTime missionInterval)
									; Figure out the last time that a habitat gave out a mission
									(setq lastMissionTime (objGetGlobalData gSource "lastMissionTime"))

									; Time between missions (5400-8990 or 3-5 real minutes)
									(setq missionInterval (add 5400 (multiply (objGetDestiny gSource) 10)))

									; Figure out which missions are valid
									(setq missionList '('destroyCentauriStation))
									(setq missionList
										(filter missionList theMission
											(switch
												; Mission to destroy a Centauri station is valid as long
												; as Arco Vaughn is alive and there are active Centauri stations
												; Also, we don't worry about stations that are far away

												(eq theMission 'destroyCentauriStation)
													(and (not (eq (typGetGlobalData &scArcoVaughnHeavyRaider; "status") 'destroyed))
														(sysFindObject gSource "TA +centauriWarlords; +populated; -occupation; -uncharted; N:450;")
														)
												Nil
												)
											)
										)

									(switch
										; If its not time for a new mission, then rumors
										(and lastMissionTime
												(gr (add lastMissionTime missionInterval) (unvGetTick)))
											(scrShowPane gScreen "Rumors")
																					
										; If we've already gotten four missions, then no more missions
										(geq (objGetGlobalData gSource "totalMissionCount") 4)
											(scrShowPane gScreen "Rumors")

										; If there are no valid missions available, then nothing
										(not missionList)
											(scrShowPane gScreen "Rumors")

										; Give out a mission
										(block (theMission)
											(setq theMission (random missionList))
											(switch
												(eq theMission 'destroyCentauriStation)
													(scrShowPane gScreen "MissionIntro")

												(scrShowPane gScreen "Rumors")
												)
											)
										)
									)
							</Action>

							<Action name="Undock" cancel="1" key="U">
								<Exit/>
							</Action>

						</Actions>

					</Default>

					<MissionIntro>
						<Initialize>
							(scrSetDesc gScreen (cat
								"The station master stands at his console. Managers and supervisors swarm around him dealing with various crises. "
								"He turns his attention towards you:\n\n"
								(plyComposeString gPlayer "\"We could use your help, %brother%. ")
								"You've got a ship with a good punch and we got something that needs punching. We'll pay you, of course.\""
								))
						</Initialize>

						<Actions>
							<Action name="Continue" key="C" default="1" cancel="1">
								(block Nil
									; Set mission time
									(objSetGlobalData gSource "lastMissionTime" (unvGetTick))

									; Go to actual mission
									(scrShowPane gScreen "Mission")
									)
							</Action>
						</Actions>
					</MissionIntro>
					
					<Mission>
						<Initialize>
							(block (desc)
								(setq gTarget Nil)

								; Look for an active warlord camp
								(setq gTarget (sysFindObject gSource "TAN +centauriWarlords; +populated; -occupation; -uncharted;"))
									 
								; If we could not find a warlord camp, create a new one
								(if (not gTarget)
									(setq gTarget
										(sysCreateStation
											(random '(&stCentauriCamp; &stCentauriCamp; &stCentauriStronghold;))
											(sysVectorRandom gSource (random 300 600) 120 "TA")									   
											)
										)
									)
									 
								; Compute reward
								(setq gReward (add 200 (multiply (objGetLevel gTarget) 100)))
									 
								; Compose message
								(setq desc (cat
									"\"A band of Centauri warlords has been harrassing this station recently. We've discovered the location of their base and we want you to go there and destroy them. "
									"If you succeed we'll pay you " gReward " credits. Will you help us?\""
									))

								(scrSetDesc gScreen desc)
								)
						</Initialize>

						<Actions>
							<Action name="Accept" key="A" default="1">
								(block (targetCount totalMissionCount)
									; Target 
									(objSetObjRefData gSource "target" gTarget)
									(objRegisterForEvents gSource gTarget)
															   
									; Order the player
									(shpCancelOrders gPlayerShip)
									(shpOrder gPlayerShip 'attack gTarget)

									; Set mission status
									(objSetData gSource "missionStatus" 'inProgress)
									(objSetGlobalData gSource "missionInProgress" True)
									(objSetData gSource "missionFee" gReward)

									; Keep track of total mission count
									(setq totalMissionCount (objGetGlobalData gSource "totalMissionCount"))
									(if (not totalMissionCount) (setq totalMissionCount 0))
									(objSetGlobalData gSource "totalMissionCount" (add totalMissionCount 1))

									(scrShowPane gScreen "MissionAccept")
									)
							</Action>
							
							<Action name="Decline" key="D" cancel="1">
								(scrShowPane gScreen "MissionDecline")
							</Action>
						</Actions>
					</Mission>
					
					<MissionAccept>
						<Initialize>
							(scrSetDesc gScreen
								"\"Thank you! I knew we could count on you. We'll program the warlord base into your ship's computer. Just follow the arrow on your screen and you'll get there. Good luck!\""
								)
						</Initialize>

						<Actions>
							<Action name="Continue" key="C" default="1" cancel="1">
								<Exit/>
							</Action>
						</Actions>
					</MissionAccept>

					<MissionSuccess>
						<Initialize>
							(block (fee)
								(objSetData gSource "missionStatus" Nil)
								(objSetGlobalData gSource "missionInProgress" Nil)
								(shpCancelOrders gPlayerShip)
								(setq fee (objGetData gSource "missionFee"))
								(plyCredit gPlayer fee)

								(scrSetDesc gScreen
									(cat "\"Great work! Maybe the warlords will think twice before attacking us again. We've deposited " fee " credits to your account.\"")
									)
								)
						</Initialize>

						<Actions>
							<Action name="Continue" key="C" default="1" cancel="1">
								(scrShowPane gScreen "Default")
							</Action>
						</Actions>
					</MissionSuccess>

					<MissionDecline>
						<Initialize>
							(scrSetDesc gScreen
								"\"Ah, Hell! What are you doing here then? Stop wasting my time!\""
								)
						</Initialize>

						<Actions>
							<Action name="Continue" key="C" default="1" cancel="1">
								(scrShowPane gScreen "Default")
							</Action>
						</Actions>
					</MissionDecline>

					<MissionInProgress>
						<Initialize>
							(block Nil
								(scrSetDesc gScreen
									"\"What's wrong? Are those warlords too tough for you? Get back out there and finish the job!\""
									)
								)
						</Initialize>

						<Actions>
							<Action name="Continue" key="C" default="1" cancel="1">
								(block Nil
									(shpCancelOrders gPlayerShip)
									(shpOrder gPlayerShip 'dock (objGetObjRefData gSource "target"))
									(scrExitDock gScreen)
									)
							</Action>
						</Actions>
					</MissionInProgress>

					<Rumors>
						<Initialize>
							(scrSetDesc gScreen
								(cat "The station master is working at his console. He stops to chat:\n\n"
									(intRandomMessage gSource "Rumors")
									)
								)
						</Initialize>

						<Actions>
							<Action name="Continue" key="C" default="1" cancel="1">
								(scrShowPane gScreen "Default")
							</Action>
						</Actions>
					</Rumors>
				</Panes>
			</Main>

		</DockScreens>

		<DockingPorts>
			<Port x="0"		y="80" />
			<Port x="43"	y="56" />
			<Port x="52"	y="8" />
			<Port x="35"	y="-44" />
			<Port x="-35"	y="-44" />
			<Port x="-52"	y="8" />
			<Port x="-43"	y="56" />
		</DockingPorts>

	</StationType>

	<!-- Container Habitat
	   
	GLOBAL DATA
	   
	donationPoints:		Donation points earned

	-->

	<StationType UNID="&stContainerHabitat;"
			name=				"Container Habitat"
			sovereign=			"&svCommonwealth;"
			dockScreen=			"Main"
			abandonedScreen=	"&dsAbandonedStation;"
			canAttack=			"true"

			multiHull=			"true"
			armorID=			"&itPlasteelPlate;"
			maxHitPoints=		"250"
			hitPoints=			"250"
			repairRate=			"1"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"commonwealth,friendly,populated"
			levelFrequency=		"uur-- ----- ----- ----- -----"
			locationCriteria=	"-planetary"
			
			noArticle=			"true"
			>

		<ImageVariants>
			<Image	imageID="&rsCommonwealthSlumsImage;" imageX="0" imageY="128" imageWidth="64" imageHeight="64"/>
			<Image	imageID="&rsCommonwealthSlumsImage;" imageX="64" imageY="128" imageWidth="64" imageHeight="64"/>
			<Image	imageID="&rsCommonwealthSlumsImage;" imageX="128" imageY="128" imageWidth="64" imageHeight="64"/>
			<Image	imageID="&rsCommonwealthSlumsImage;" imageX="192" imageY="128" imageWidth="64" imageHeight="64"/>
		</ImageVariants>

		<Ships>
			<Table count="1d2-1">
				<Ship chance="50" count="1" class="&scEI100;"/>
				<Ship chance="25" count="1" class="&scSapphireYacht;"/>
				<Ship chance="25" count="1" class="&scBorer;"/>
			</Table>
		</Ships>

		<StaticData>
			<DonationTable>
				; donate =	If -1, gain 1 donation point per item donated
				;			If 0, gain no donation points
				;			If greater than 0, this is the credit value to gain 1 donation point
				
				(	; pattern				donate	result
					("*+Meds;"				100		'info)
					("*+Illegal;"			500		'info)
					("*+Lux;"				250		'info)
					("*+Food;"				100		'info)
					("f"					100		'info)
					(Nil					0		'thanksForNothing)
					)
			</DonationTable>

			<Rumors>
				(
					"\"Watch out for Arco Vaughn. He is the most dangerous Centauri warlord; his heavy raider is protected against lasers and recoilless cannons. Avoid him if you want to live.\""
					"\"Arco Vaughn flies an enhanced heavy raider. His armor is protected against normal weapons; you'll need missiles to kill him.\""
					"\"Raisu Station is in trouble. The Centauri warlords have taken it over; don't go there unless you are armed and ready.\""
					"\"If you want to find Arco Vaugh, go to Raisu Station. Talk to the station master there. She will help you.\""
					"\"The Centauri warlords have many bases among the outer asteroids of Eridani; but if you go there, watch out: Arco Vaughn is there too.\""
					)
			</Rumors>
		</StaticData>

		<Events>
			<OnContractGenerate>
				(intGenerateStandardRequestContract1)
			</OnContractGenerate>

			<OnContractQuery>True</OnContractQuery>

			<OnDestroy>
				(intCommonwealthOnDestroy)
			</OnDestroy>
			
			<OnObjDestroyed>
				(if (eq aObjDestroyed (objGetObjRefData gSource "target"))
					(block Nil
						(shpCancelOrders gPlayerShip)
						(objUnregisterForEvents gSource aObjDestroyed)
						(objSetData gSource "missionID" Nil)
						)
					)
			</OnObjDestroyed>
			
			<OnObjDocked>
				(if (eq aDockTarget (objGetObjRefData gSource "target"))
					(block Nil
						(shpCancelOrders gPlayerShip)
						(objUnregisterForEvents gSource gPlayerShip)
						(objSetData gSource "missionID" Nil)
						)
					)
			</OnObjDocked>
			
			<OrderDestroyTarget>
				(block Nil
					; Clean up in case we have a previous mission
					(if (eq (objGetData gSource "missionID") 'dockWithTarget)
						(objUnregisterForEvents gSource gPlayerShip)
						)

					(objSetData gSource "missionID" 'destroyTarget)
					(objSetObjRefData gSource "target" aTargetObj)
					(objRegisterForEvents gSource aTargetObj)

					(shpCancelOrders gPlayerShip)
					(shpOrder gPlayerShip 'attack aTargetObj)
					)
			</OrderDestroyTarget>
			
			<OrderDockWithTarget>
				(block Nil
					; Clean up in case we have a previous mission
					(if (eq (objGetData gSource "missionID") 'destroyTarget)
						(objUnregisterForEvents gSource (objGetObjRefData gSource "target"))
						)

					(objSetData gSource "missionID" 'dockWithTarget)
					(objSetObjRefData gSource "target" aTargetObj)
					(objRegisterForEvents gSource gPlayerShip)

					(shpCancelOrders gPlayerShip)
					(shpOrder gPlayerShip 'dock aTargetObj)
					)
			</OrderDockWithTarget>
		</Events>

		<DockScreens>
			<Main
				name=			"=(objGetName gSource)"
				>

				<OnInit>
					(intCommonwealthOnInit "Main")
					</OnInit>
					
				<Panes>
					<Default>
						<Initialize>
							(scrSetDesc gScreen (cat
								"You are docked at a habitat made out of shipping containers. Children bounce off the bulkheads in zero-G while "
								"maintenance workers repair leaky seals and balky machinery. The station master approaches you:\n\n"
								"\"We don't get many pilgrims visiting around here. Why don't you give us some of your worldly possessions; "
								"they won't do you much good at the Core, or wherever you're trying to get.\""
								))
						</Initialize>

						<Actions>
							<Action name="Donate item" key="D" default="1">
								(block Nil
									(setq gPrevScreen "Main")
									(setq gPrevPane "Default")
									(scrShowScreen gScreen "&dsContainerHabitatDonateItem;")
									)
							</Action>

							<Action name="Undock" cancel="1" key="U">
								<Exit/>
							</Action>

						</Actions>

					</Default>
				</Panes>
			</Main>

		</DockScreens>

		<DockingPorts>
			<Port x="0"		y="70" />
			<Port x="61"	y="35" />
			<Port x="61"	y="-35" />
			<Port x="0"		y="-70" />
			<Port x="-61"	y="-35" />
			<Port x="-61"	y="35" />
		</DockingPorts>

	</StationType>

	<!-- Commonwealth Settlement -->

	<StationType UNID="&stCommonwealthSettlement;"
			name=				"(commonwealth settlement)"
			sovereign=			"&svCommonwealth;"
			dockScreen=			"Main"
			abandonedScreen=	"&dsAbandonedStation;"
			dockingPorts=		"8"
			canAttack=			"true"

			multiHull=			"true"
			armorID=			"&itP120HexphaseArmor;"
			maxHitPoints=		"250"
			hitPoints=			"250"
			repairRate=			"1"
			shipRepairRate=		"1"
			explosionType=		"&vtThermoExplosion1;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"commonwealth,fleetDelivery,friendly,populated"
			levelFrequency=		"----- -ucr- ----- ----- -----"
			locationCriteria=	"+planetary"

			noArticle=			"true"
			>

		<Names>Commonwealth Settlement %1%0%0%0</Names>
		
		<Image			imageID="&rsStations1;" imageX="0" imageY="256" imageWidth="128" imageHeight="128"/>

		<Devices>
			<Device deviceID="&itTeV9Blaster;"	omnidirectional="true"/>
		</Devices>

		<Items>
			<RandomItem count="10" 
					criteria=		"ad -Illegal; -Military; -Alien; -Specialty; -NotForSale;"
					level=			"8"
					levelCurve=		"1"
					/>
			<RandomItem count="10" 
					criteria=		"* -Illegal; -Military; -Alien; -Specialty; -NotForSale;"
					level=			"8"
					levelCurve=		"2"
					/>
			<RandomItem count="3" 
					criteria=		"* -Illegal; -Military; -Alien; -Specialty; -NotForSale;"
					level=			"9"
					levelCurve=		"1"
					/>

			<Item count="4d12"	item="&itXenotiteFuelRod;" />
		</Items>

		<Trade currency="credit" creditConversion="100" max="50000" replenish="2500">
			<Sell	criteria="*NU -Illegal; -ID; -NotForSale;"	priceAdj="110"/>
			<Buy	criteria="amswNU -Illegal; -NotForSale;"		priceAdj="50"/>
			<Buy	criteria="*NU -Illegal; -ID; -NotForSale;"	priceAdj="90"/>
			<Buy	criteria="*NU -Illegal; -ID;"				priceAdj="10"/>
		</Trade>

		<Ships>
			<Table count="2">
				<Ship chance="50" count="1" class="&scEI100M;" orders="guard"/>
				<Ship chance="30" count="1" class="&scRoninC;" orders="guard"/>
				<Ship chance="20" count="1" class="&scCenturion;" orders="guard"/>
			</Table>

			<Table count="1d4">
				<Ship chance="25" count="1" class="&scEI500;" orders="gateOnThreat"/>
				<Ship chance="25" count="1" class="&scWolfen;" orders="gateOnThreat"/>
				<Ship chance="20" count="1" class="&scSapphireYacht;" orders="gateOnThreat"/>
				<Ship chance="20" count="1" class="&scBorer;" orders="gateOnThreat"/>
				<Ship chance="10" count="1" class="&scCenturion;" orders="guard"/>
			</Table>
		</Ships>

		<Reinforcements minShips="5">
			<Table>
				<Ship chance="50" count="1" class="&scRoninC;" orders="guard"/>
				<Ship chance="50" count="1" class="&scCenturion;" orders="guard"/>
			</Table>
		</Reinforcements>

		<Satellites>
			<Orbitals distance="7" angle="45">
				<Station type="&stCommonwealthTurret;" imageVariant="2"/>
			</Orbitals>

			<Orbitals distance="7" angle="135">
				<Station type="&stCommonwealthTurret;" imageVariant="1"/>
			</Orbitals>

			<Orbitals distance="7" angle="225">
				<Station type="&stCommonwealthTurret;" imageVariant="0"/>
			</Orbitals>

			<Orbitals distance="7" angle="315">
				<Station type="&stCommonwealthTurret;" imageVariant="3"/>
			</Orbitals>
		</Satellites>

		<Events>
			<OnContractGenerate>
				(intGenerateStandardRequestContract1)
			</OnContractGenerate>

			<OnContractQuery>True</OnContractQuery>

			<OnDestroy>
				(intCommonwealthOnDestroy)
			</OnDestroy>
		</Events>

		<DockScreens>
			<Main
				name=			"=(objGetName gSource)"
				>

				<OnInit>
					(intCommonwealthOnInit "Main")
				</OnInit>

				<Panes>
					<Default
							desc=	"You are in the docking bay of a Commonwealth settlement. Except for a few shuttles, the docking bay of this station is deserted. A loose hose is spilling dirty water onto the landing pad; elsewhere, an automatic load-lifter moves forward and back again as it unloads a ship's cargo hold. The air smells of liquid fuel and exhaust.">

						<Actions>
							<Action name="Commodities Exchange" default="1" key="C">
								<ShowPane pane="CommoditiesExchange"/>
							</Action>

							<Action name="Dock Services" key="D">
								<ShowPane pane="DockServices"/>
							</Action>

							<Action name="Undock" cancel="1" key="U">
								<Exit/>
							</Action>

						</Actions>

					</Default>

					<CommoditiesExchange>

						<Initialize>
							(scrSetDesc gScreen (cat "Welcome to the " (objGetName gSource) " Commodities Exchange Market."))
						</Initialize>

						<Actions>
							<Action name="Buy items" default="1" key="B">
								(block Nil
									(setq gPrevScreen "Main")
									(setq gMargin Nil)
									(setq gInstallCriteria Nil)
									(scrShowScreen gScreen "&dsExchangeBuy;")
									)
							</Action>

							<Action name="Sell items" key="S">
								(block Nil
									(setq gPrevScreen "Main")
									(setq gMargin Nil)
									(setq gTitle Nil)
									(scrShowScreen gScreen "&dsExchangeSell;")
									)
							</Action>

							<Action name="Done" cancel="1" key="D">
								<ShowPane pane="Default"/>
							</Action>

						</Actions>

					</CommoditiesExchange>

					<DockServices
							desc=	"You are at the docking services terminal.">

						<Actions>
							<Action name="Refuel" key="R">
								(block Nil
									(setq gPrevScreen "Main")
									(setq gPrevPane "DockServices")
									(intSetCompatibleFuel '((&itXenotiteFuelRod; 150) (&itHeliumAssembly; 70) (&itHelium3FuelRod; 22)))
									(scrShowScreen gScreen "&dsRefuel;")
									)
							</Action>

							<Action name="Repair or replace armor" key="A" >
								(block Nil
									(setq gPrevScreen "Main")
									(setq gPrevPane "DockServices")
									(setq gTechLevel 8)
									(setq gArmorSegment 0)
									(setq gMargin 100)
									(scrShowScreen gScreen "&dsRepairArmor;")
									)
							</Action>

							<Action name="Done" cancel="1" key="D">
								<ShowPane pane="Default"/>
							</Action>

						</Actions>

					</DockServices>

				</Panes>
			</Main>

		</DockScreens>

		<DockingPorts>
			<Port x="0"		y="90" />
			<Port x="0"		y="-90" />
			<Port x="60"	y="60" />
			<Port x="60"	y="-60" />
			<Port x="90"	y="0" />
			<Port x="-90"	y="0" />
			<Port x="-60"	y="60" />
			<Port x="-60"	y="-60" />
		</DockingPorts>

	</StationType>

	<Globals>
		(block Nil
			(setq intCommonwealthCrime (lambda (severity description)
				(if (gr severity (int (objGetData gPlayerShip "commonCrimeSeverity")))
					(block Nil
						(objSetData gPlayerShip "commonCrimeSeverity" severity)
						(objSetData gPlayerShip "commonCrime" description)
						)
					)
				))

			(setq intCommonwealthOnDestroy (lambda Nil
				(block Nil
					; Destroy items on the station
					(intDestroyItems gSource)
					
					; Add to the player's record
					(if (eq (objGetOrderGiver aDestroyer aDestroyReason) gPlayerShip)
						(intCommonwealthCrime 3 (cat "the destruction of " (objGetName gSource 4)))
						)
					)
				))
				
			(setq intCommonwealthOnInit	(lambda (prevScreen)
				(block (missionObj)
					(setq gPrevScreen prevScreen)

					(switch
						; If the ship is radioactive then we need to decontaminate
						(shpIsRadioactive gPlayerShip)
							(scrShowScreen gScreen "&dsCommonwealthDecon;")

						; If the player has sold slaves then he/she is arrested
						(geq (int (objGetData gPlayerShip "commonCrimeSeverity")) 2)
							(scrShowScreen gScreen "&dsCommonwealthImprison;")

						; If we have slaves then free them
						(objGetItems gPlayerShip "*+Slaves;")
							(scrShowScreen gScreen "&dsCommonwealthFreeSlaves;")

						; If the player has a black market container, then she is imprisoned
						(and (not (objGetItems gPlayerShip "*I+SmugglersHold;")) 
								(objGetItems gPlayerShip "*U+SealedContainer;")
								)
							(block Nil
								(intCommonwealthCrime 2 "smuggling")
								(scrShowScreen gScreen "&dsCommonwealthImprison;")
								)

						; If we have illegal items in the cargo hold then we need
						; to confiscate them
						(and (not (objGetItems gPlayerShip "*I+SmugglersHold"))
								(or (objGetItems gPlayerShip "*U+Illegal; -ID")
									(and (objGetItems gPlayerShip "*U+Military") (not (objGetItems gPlayerShip "*+MilitaryID")))))
							(scrShowScreen gScreen "&dsCommonwealthConfiscate;")

						; If the player needs to deliver items, then do so
						(objGetData gSource "fleetMissionCargo")
							(scrShowScreen gScreen "&dsFleetDelivery;")

						; Check if the player has any active contracts
						(intShowContractDeliveryScreen)
							(scrShowScreen gScreen "&dsContractDelivery;")
						)
					)
				))
			)
	</Globals>

	<!-- Commonwealth Confiscate
		
		gPrevScreen: Must be set to the name/UNID of the screen to
				navigate to when done.
		-->

	<DockScreen UNID="&dsCommonwealthConfiscate;"
			name=				"=(objGetName gSource)"
			>

		<Panes>
			<Default>
				<Initialize>
					(block (desc itemToRemove)
						;NOTE: itemsToConfiscate must be a global variable or else
						;it will not be properly set inside the enum.
						(setq itemsToConfiscate Nil)
						(if (not (objGetItems gPlayerShip "*I+SmugglersHold"))
							(objEnumItems gPlayerShip "*U+Illegal; -ID" theItem
								(setq itemsToConfiscate (lnkAppend itemsToConfiscate theItem))
								)
							)

						(if (not (objGetItems gPlayerShip "*+MilitaryID"))
							(objEnumItems gPlayerShip "*U+Military" theItem
								(setq itemsToConfiscate (lnkAppend itemsToConfiscate theItem))
								)
							)

						(enum itemsToConfiscate itemToRemove
							(objRemoveItem gPlayerShip itemToRemove)
							)

						(setq desc "Commonwealth Customs has inspected your ship's cargo hold and confiscated ")
						(if (eq (count itemsToConfiscate) 1)
							(scrSetDesc gScreen (cat desc (itmGetName (item itemsToConfiscate 0) 8) "."))
							(block (i)
								(for i 0 (subtract (count itemsToConfiscate) 3)
									(setq desc (cat desc (itmGetName (item ItemsToConfiscate i) 8) ", "))
									)
								(setq desc (cat desc (itmGetName (item ItemsToConfiscate (subtract (count itemsToConfiscate) 2)) 8) " and "))
								(setq desc (cat desc (itmGetName (item ItemsToConfiscate (subtract (count itemsToConfiscate) 1)) 8) "."))
								(scrSetDesc gScreen desc)
								)
							)
						)
				</Initialize>

				<Actions>
					<Action name="Continue" default="1" cancel="1" key="C">
						(scrShowScreen gScreen gPrevScreen)
					</Action>
				</Actions>

			</Default>
		</Panes>

	</DockScreen>

	<!-- Commonwealth Decontamination
		
		gPrevScreen: Must be set to the name/UNID of the screen to
				navigate to when done.
		-->

	<DockScreen UNID="&dsCommonwealthDecon;"
			name=				"=(objGetName gSource)"
			>

		<Panes>
			<Default>
				<Initialize>
					(if (geq (plyGetCredits gPlayer) 250)
						(block Nil
							(scrSetDesc gScreen "Commonwealth Customs stops your ship for decontamination. You are automatically charged 250 credits for decontaminating your ship.")
							(plyCharge gPlayer 250)
							(shpDecontaminate gPlayerShip)
							)
						(scrSetDesc gScreen "Commonwealth Customs stops your ship for decontamination. Unfortunately, you cannot afford the 250 credit cost of decontamination.")
						)
				</Initialize>

				<Actions>
					<Action name="Continue" default="1" cancel="1" key="C">
						(if (not (shpIsRadioactive gPlayerShip))
							(scrShowScreen gScreen gPrevScreen)
							(scrExitDock gScreen)
							)
					</Action>
				</Actions>

			</Default>
		</Panes>

	</DockScreen>

	<!-- Commonwealth Free Slaves
		
		gPrevScreen: Must be set to the name/UNID of the screen to
				navigate to when done.
		-->

	<DockScreen UNID="&dsCommonwealthFreeSlaves;"
			name=				"=(objGetName gSource)"
			>

		<Panes>
			<Default>
				<Initialize>
					(block (desc itemToRemove)
						; Free the slaves
						(setq totalSlaves 0)
						(enum (objGetItems gPlayerShip "*+Slaves;") itemToRemove
							(block Nil
								(setq totalSlaves (add totalSlaves (itmGetCount itemToRemove)))
								(objRemoveItem gPlayerShip itemToRemove)
								)
							)

						; Keep track of how many we have freed in total
						(objIncData gPlayerShip "slavesFreed" totalSlaves)

						; Create description
						(setq desc "As soon as you dock you inform the Commonwealth authorities that you have rescued ")
						(switch
							(eq totalSlaves 1)
								(setq desc (cat desc "a slave. The jaded officer takes the slave coffin and files a routine report."))

							(eq totalSlaves 2)
								(setq desc (cat desc "a couple of slaves. The jaded officer takes the two slave coffins and files a routine report."))

							(setq desc (cat desc "several slaves. The officer in charge thanks you for your role in the rescue: \"You must have a pretty good ship to have survived a fight against Slavers!\""))
							)

						(scrSetDesc gScreen desc)
						)
				</Initialize>

				<Actions>
					<Action name="Continue" default="1" cancel="1" key="C">
						(block (freed rewarded)
							(setq freed (objGetData gPlayerShip "slavesFreed"))
							(setq rewarded (objGetData gPlayerShip "slaveReward"))

							(switch
								(and (geq freed 12) (ls rewarded 12))
									(scrShowPane gScreen "Reward1")

								(and (geq freed 24) (ls rewarded 24))
									(scrShowPane gScreen "Reward1")

								(scrShowScreen gScreen gPrevScreen)
								)
							)
					</Action>
				</Actions>

			</Default>

			<Reward1>
				<Initialize>
					(block (reward roll)
						; Create a random reward
						(setq roll (random 1 100))
						(switch
							(ls roll 25)
								(setq reward (itmCreate &itLongzhuSphere; (random 1 3)))

							(ls roll 60)
								(setq reward (itmCreate &itPromethiumCrystal; (random 1 4)))

							(setq reward (itmCreate &itCalligraphyScroll; 1))
							)

						; Give it to the player
						(objAddItem gPlayerShip reward)
						(scrSetDesc gScreen (cat "Once revived, one of the former slaves turns to you and puts something in your hand. She turns and walks away without saying a word. When you open your hand you see: " (itmGetName reward 8) "."))
						)
				</Initialize>

				<Actions>
					<Action name="Continue" default="1" cancel="1" key="C">
						(block Nil
							(objSetData gPlayerShip "slaveReward" (objGetData gPlayerShip "slavesFreed"))
							(scrShowScreen gScreen gPrevScreen)
							)
					</Action>
				</Actions>
			</Reward1>
		</Panes>

	</DockScreen>

	<!-- Commonwealth Imprison
		
		-->

	<DockScreen UNID="&dsCommonwealthImprison;"
			name=				"=(objGetName gSource)"
			>

		<Panes>
			<Default>

				<Initialize>
					(block Nil
						(scrSetDesc gScreen (cat "As you enter the station you are surrounded by heavily armed soldiers. A Commonwealth official approaches you: \"You are under arrest for " (objGetData gPlayerShip "commonCrime") "\"" ))
						(plyDestroyed gPlayer (cat "imprisoned for " (objGetData gPlayerShip "commonCrime")))
						)
				</Initialize>

				<Actions>
					<Action name="Continue" default="1" cancel="1" key="C">
						(scrExitDock gScreen)
					</Action>
				</Actions>

			</Default>
		</Panes>

	</DockScreen>

	<!-- Donate Item to Container Habitat

		gPrevScreen: Must be set to the name/UNID of the screen to
				navigate to when done.
		gPrevPane: Must be set to the name of the pane to navigate
				to when done.
		-->
	
	<DockScreen UNID="&dsContainerHabitatDonateItem;"
			name=				"=(objGetName gSource)"
			type=				"itemPicker"
			backgroundID=		"&rsItemListScreen;"
			>

		<ListOptions
			dataFrom=	"player"
			list=		"*U"
			/>

		<Panes>
			<Default>

				<Initialize>
					(block Nil
						(setq gItem (scrGetItem gScreen))
						(setq gMaxCount (itmGetCount gItem))
						(scrSetDesc gScreen "\"What do you want to give us?\"")
						)
				</Initialize>

				<Actions>
					<Action name="Donate this item" default="1" key="D">
						(switch
							(gr gMaxCount 1)
								(scrShowPane gScreen "Quantity")

							(eq gMaxCount 1)
								(block Nil
									(setq gItem (scrRemoveItem gScreen 1))
									(scrShowScreen gScreen "&dsContainerHabitatReward;" "Donate")
									)
							)
					</Action>
						
					<Action name="Cancel" cancel="1" key="C">
						(scrShowScreen gScreen gPrevScreen gPrevPane)
					</Action>
				</Actions>					
			</Default>
				
			<Quantity
					showCounter=	"true">

				<Initialize>
					(block Nil
						(scrSetDesc gScreen (cat "\"How many " (itmGetName gItem 0x02) " do you want to give us?\""))
						(scrSetCounter gScreen gMaxCount)
						)
				</Initialize>

				<Actions>
					<Action name="Donate" default="1" key="D">
						(block (count)
							(setq count (scrGetCounter gScreen))
							(if (gr count gMaxCount)
								(scrSetCounter gScreen gMaxCount)
								(block Nil
									(setq gItem (scrRemoveItem gScreen count))
									(scrShowScreen gScreen "&dsContainerHabitatReward;" "Donate")
									)
								)
							)
					</Action>

					<Action name="Cancel" cancel="1" key="C">
						<ShowPane pane="Default"/>
					</Action>

				</Actions>
			</Quantity>
				
		</Panes>
			
	</DockScreen>
		
	<DockScreen UNID="&dsContainerHabitatReward;"
			name=				"=(objGetName gSource)"
			>
		<Panes>
			<Donate>
				<Initialize>
					(block (table entry criteria totalValue)
						; Look for the entry in the donation table
						
						(setq table (objGetStaticData gSource "DonationTable"))
						(setq entry Nil)
						(enumwhile table (not entry) thisEntry
							(switch
								; If the criteria in the table is Nil, then we always match. This
								; is for the last (default) entry.
								(not (setq criteria (item thisEntry 0)))
									(setq entry thisEntry)
									
								; If the criteria is an integer, then we see if this is the UNID
								; of the item.
								(isint criteria)
									(if (eq (itmGetUNID gItem) criteria)
										(setq entry thisEntry)
										)
									
								; If the criteria matches, then we have an entry
								(itmMatches gItem criteria)
									(setq entry thisEntry)
								)
							)
							
						; Deal with the entry that we found
						
						(setq gResult (item entry 2))
										  
						; Calculate how valuable the donation was
						
						(setq totalValue (multiply (itmGetPrice gItem) (itmGetCount gItem)))
						(switch
							; If 0, then we get result regardless of quantity
							(eq (item entry 1) 0)
								(setq gResultValue Nil)
								
							; If -1, then each item counts for +1 donation points
							(eq (item entry 1) -1)
								(setq gResultValue (itmGetCount gItem))
								
							; Otherwise, depends on the value of the item
							(setq gResultValue (divide totalValue (item entry 1)))
							)
							 
						; Accumulate donation points
						(block (donationPoints)
							(setq donationPoints (objGetGlobalData gSource "donationPoints"))
							(if (not donationPoints) (setq donationPoints 0))

							(if gResultValue
								(setq donationPoints (add donationPoints gResultValue))
								)

							(objSetGlobalData gSource "donationPoints" donationPoints)
							)

						; Deal with the result appropriately

						(switch
							(and gResultValue (eq gResultValue 0))
								(block Nil
									(setq desc "\"Thanks, that's something we need more of around here.\"")
									(setq gResult 'thanksForNothing)
									)

							(eq gResult 'info)
								(setq desc (plyComposeString gPlayer (cat
									"\"Thank you, %sir%! We'll put " (itmGetName gItem 0x40) " to good use. Maybe I can help you in return.\""
									)))

							; Thanks for nothing
							(block Nil
								(setq desc (cat
									"\"Yeah, I guess you won't be needing" 
									(if (gr (itmGetCount gItem) 1) " them " " that ")
									"where you're going. Not sure we need"
									(if (gr (itmGetCount gItem) 1) " them " " it ")
									"ourselves, but thanks anyway.\""
									))
								(setq gResult 'thanksForNothing)
								)
							)
							 
						(scrSetDesc gScreen desc)
						)
				</Initialize>
					
				<Actions>
					<Action name="Continue" cancel="1" default="1" key="C">
						(switch
							(eq gResult 'info)
								(if (geq (objGetGlobalData gSource "donationPoints") 5)
									(scrShowPane gScreen "RewardInfo")
									(scrShowPane gScreen "RewardInfoRumors")
									)

							(scrShowScreen gScreen gPrevScreen gPrevPane)
							)
					</Action>
				</Actions>
					
			</Donate>
			
			<RewardInfo>
				<Initialize>
					(block (donationPoints)
						(scrSetDesc gScreen (cat
							"\"I know a thing or two about getting around in this system. What do you need to know?\""
							))
							  
						(setq donationPoints (objGetGlobalData gSource "donationPoints"))

						; Arco Vaughn info available after 20 donation points
						(scrShowAction gScreen 2 (geq donationPoints 20))

						; Centauri base info available after 10 donation points
						(scrShowAction gScreen 1 (geq donationPoints 10))
						
						; Equipment location available after 5 donation points
						(scrShowAction gScreen 0 (geq donationPoints 5))
						)
				</Initialize>

				<Actions>
					<Action name="&quot;I need better equipment&quot;" key="e">
						(scrShowPane gScreen "RewardInfoEquipment")
					</Action>

					<Action name="&quot;Where are the Centauri warlords?&quot;" key="C">
						(scrShowPane gScreen "RewardInfoCentauriBase")
					</Action>

					<Action name="&quot;Where is Arco Vaughn?&quot;" key="A">
						(scrShowPane gScreen "RewardInfoArcoVaughn")
					</Action>
					
					<Action name="&quot;Nevermind, I'm all set&quot;" key="N" cancel="1">
						(scrShowScreen gScreen gPrevScreen gPrevPane)
					</Action>
				</Actions>
			</RewardInfo>
			
			<RewardInfoRumors>
				<Initialize>
					(scrSetDesc gScreen (cat
						"The station master grabs you and speaks softly in your ear:\n\n"
						(random (objGetStaticData gSource "Rumors"))
						))
				</Initialize>

				<Actions>
					<Action name="Continue" cancel="1" default="1" key="C">
						(scrShowScreen gScreen gPrevScreen gPrevPane)
					</Action>
				</Actions>
			</RewardInfoRumors>

			<RewardInfoEquipment>
				<Initialize>
					(block (desc bestObj bestItem allItems bestItems)
						(setq aTargetObj Nil)
						(setq aEvent Nil)
						(setq desc "")

						; Make a list of all potential items
						(setq allItems Nil)
						(enum (sysFindObject gSource "T") theObj
							(enum (objGetItems theObj "wsUN") theItem
								(if	(and (geq (itmGetLevel theItem) 3)
										(not (objHasItem gPlayerShip theItem))
										(or (objIsEnemy gPlayerShip theObj)
											(gr (objGetSellPrice theObj theItem) 0)))
									(setq allItems (append allItems (list (list theObj theItem))))
									)
								)
							)
							 
						; Filter out any items that the player already has installed
						(setq allItems (filter allItems theEntry
							(not 
								; This filter returns the set of installed items that is equal
								; to the items that we found
								(filter (objGetItems gPlayerShip "wsI") theItem
									(eq (itmGetUNID theItem) (itmGetUNID (item theEntry 1)))
									)
								)
							))
						
						; Make a list of lootable items or items that the player doesn't know about
						(setq bestItems (filter allItems theEntry
							(or (objIsEnemy gPlayerShip (item theEntry 0))
								(objIsKnown (item theEntry 0))
								)
							))
						(if (not bestItems)
							(setq bestItems allItems)
							)

						; Pick a random high-level item
						(setq bestItem Nil)
						(setq bestObj Nil)
						(if bestItems
							(for i 1 10
								(block (trialEntry)
									(setq trialEntry (random bestItems))
									(if (or (not bestItem)
											(gr (itmGetLevel (item trialEntry 1)) (itmGetLevel bestItem)))
										(block Nil
											(setq bestObj (item trialEntry 0))
											(setq bestItem (item trialEntry 1))
											)
										)
									)
								)
							)

						; If an item was found, then set up everything
						(if bestItem
							(block Nil
								(setq desc (cat desc
									"\""
									(objGetName bestObj 0x05) " in this system has "
									(itmGetName bestItem 0x04) ". "
									(if (objIsEnemy gPlayerShip bestObj)
										"If you destroy the station, you will be able to loot it. "
										"If you go to the station you will be able to buy it. "
										)
									"I'll give you the coordinates, if you want.\""
									))

								(setq aTargetObj bestObj)
								(if (objIsEnemy gPlayerShip bestObj)
									(setq aEvent "OrderDestroyTarget")
									(setq aEvent "OrderDockWithTarget")
									)
								)

							; Otherwise, if no item found, then we're sorry
							(setq desc (cat desc
								"\"Sorry, I don't know of anything in the system that could help you.\""
								))
							)

						(scrSetDesc gScreen desc)
										  
						; Enable disable buttons
						(scrShowAction gScreen 0 aEvent)
						(scrShowAction gScreen 1 aEvent)
						(scrShowAction gScreen 2 (not aEvent))
						)
				</Initialize>

				<Actions>
					<Action name="&quot;Give me the coordinates, please!&quot;" key="C" default="1">
						(block Nil
							(objFireEvent gSource aEvent)
							(scrShowPane gScreen "RewardInfoDone")
							)
					</Action>
					
					<Action name="&quot;Nevermind, I'm all set&quot;" key="N" cancel="1">
						(scrShowScreen gScreen gPrevScreen gPrevPane)
					</Action>

					<Action name="Continue" cancel="1" default="1" key="C">
						(scrShowScreen gScreen gPrevScreen gPrevPane)
					</Action>
				</Actions>
			</RewardInfoEquipment>

			<RewardInfoCentauriBase>
				<Initialize>
					(block (desc targetList)
						(setq aTargetObj Nil)
						(setq aEvent Nil)
						(setq desc "The station master grabs you and speaks softly in your ear:\n\n")

						(setq targetList (sysFindObject gSource "TA +centauriWarlords; +populated; -occupation; -uncharted;"))
						(if targetList
							(block Nil
								(setq aTargetObj (random targetList))
								(setq desc (cat desc
									"\"I know the location of one of the Centauri bases. I'll give you the coordinates so that you can destroy it. But don't tell anyone where you got it, OK?\""
									))

								; Set player target
								(setq aEvent "OrderDestroyTarget")
								)
							(setq desc "\"Sorry, I don't know of any active Centauri bases in this system.\"")
							)

						(scrSetDesc gScreen desc)

						; Enable disable buttons
						(scrShowAction gScreen 0 aEvent)
						(scrShowAction gScreen 1 aEvent)
						(scrShowAction gScreen 2 (not aEvent))
						)

				</Initialize>

				<Actions>
					<Action name="&quot;Give me the coordinates, please!&quot;" key="C" default="1">
						(block Nil
							(objFireEvent gSource aEvent)
							(scrShowPane gScreen "RewardInfoDone")
							)
					</Action>
					
					<Action name="&quot;Nevermind, I'm all set&quot;" key="N" cancel="1">
						(scrShowScreen gScreen gPrevScreen gPrevPane)
					</Action>

					<Action name="Continue" cancel="1" default="1" key="C">
						(scrShowScreen gScreen gPrevScreen gPrevPane)
					</Action>
				</Actions>
			</RewardInfoCentauriBase>

			<RewardInfoArcoVaughn>
				<Initialize>
					(block (desc targetList)
						(setq aTargetObj Nil)
						(setq aEvent Nil)
						(setq desc "The station master grabs you and speaks softly in your ear:\n\n")

						(switch
							(eq (typGetGlobalData &scArcoVaughnHeavyRaider; "status") 'destroyed)
								(setq desc (cat
									"\"Arco Vaughn is dead, thankfully!\""
									))

							(not (sysFindObject gSource "s +arcoVaughn;"))
								(setq desc (cat
									"\"Arco Vaughn is not in this system; last I heard he was in the Eridani system.\""
									))

							(block Nil
								(setq desc (cat desc
									"\"If you're hunting Arco Vaughn, I know where you can find him. He has a habitat deep in the outer system. "
									"I'll give you his coordinates, but don't say where you got them.\""
									))

								; Set player target
								(setq aTargetObj (sysFindObject gSource "sN +arcoVaughn;"))
								(setq aEvent "OrderDestroyTarget")
								)
							)

						(scrSetDesc gScreen desc)

						; Enable disable buttons
						(scrShowAction gScreen 0 aEvent)
						(scrShowAction gScreen 1 aEvent)
						(scrShowAction gScreen 2 (not aEvent))
						)

				</Initialize>

				<Actions>
					<Action name="&quot;Give me his coordinates, please!&quot;" key="C" default="1">
						(block Nil
							(objFireEvent gSource aEvent)
							(scrShowPane gScreen "RewardInfoDone")
							)
					</Action>
					
					<Action name="&quot;Nevermind, I'm all set&quot;" key="N" cancel="1">
						(scrShowScreen gScreen gPrevScreen gPrevPane)
					</Action>

					<Action name="Continue" cancel="1" default="1" key="C">
						(scrShowScreen gScreen gPrevScreen gPrevPane)
					</Action>
				</Actions>
			</RewardInfoArcoVaughn>

			<RewardInfoDone>
				<Initialize>
					(scrSetDesc gScreen (cat
						"\"Done. Just follow the marker on your display and you will get there."
						(if (objIsEnemy gSource aTargetObj)
							" Remember, don't say anything about where you got it.\""
							"\""
							)
						))
				</Initialize>
				
				<Actions>
					<Action name="Continue" key="C" default="1" cancel="1">
						<Exit/>
					</Action>
				</Actions>
			</RewardInfoDone>
		</Panes>
	</DockScreen>

	<!-- Dry dock screen -->

	<DockScreen UNID="&dsDryDock;"
			name=				"=(objGetName gSource)"
			desc=				"Your ship is in dry dock"
			type=				"dryDock"
			>

		<OnInit>
			(intCommonwealthOnInit "&dsDryDock;")
		</OnInit>

		<Panes>
			<Default
					desc=	"Your ship is in dry dock.">

				<Actions>
					<Action name="Refuel" key="R">
						(block Nil
							(setq gPrevScreen "&dsDryDock;")
							(setq gPrevPane Nil)
							(intSetCompatibleFuel '((&itXenotiteFuelRod; 150) (&itHeliumAssembly; 70) (&itHelium3FuelRod; 20)))
							(scrShowScreen gScreen "&dsRefuel;")
							)
					</Action>

					<Action name="Repair or replace armor" key="A" >
						(block Nil
							(setq gPrevScreen "&dsDryDock;")
							(setq gPrevPane Nil)
							(setq gTechLevel 8)
							(setq gArmorSegment 0)
							(setq gMargin 100)
							(scrShowScreen gScreen "&dsRepairArmor;")
							)
					</Action>

					<Action name="Install device" key="D" >
						(block Nil
							(setq gPrevScreen "&dsDryDock;")
							(setq gPrevPane Nil)
							(setq gTechLevel 7)
							(setq gTechModifier Nil)
							(setq gCheckMilitaryID True)
							(setq gMargin 100)
							(scrShowScreen gScreen "&dsInstallDevice;")
							)
					</Action>

					<Action name="Remove device" key="V" >
						(block Nil
							(setq gPrevScreen "&dsDryDock;")
							(setq gPrevPane Nil)
							(setq gMargin 100)
							(scrShowScreen gScreen "&dsRemoveDevice;")
							)
					</Action>

					<Action name="Upgrade reactor" key="P" >
						(block (maxPower)
							(setq gPrevScreen "&dsDryDock;")
							(setq gPrevPane Nil)
							(setq gCheckMilitaryID True)
							
							; Figure out what reactor to upgrade to
							(setq maxPower (objGetMaxPower gPlayerShip))
							
							(switch
								(ls maxPower 250)
									(block Nil
										(setq gCost 3000)
										(setq gItem (itmCreate &it25MWReactor; 1))
										)

								(ls maxPower 500)
									(block Nil
										(setq gCost 5500)
										(setq gItem (itmCreate &it50MWReactor; 1))
										)
										
								(ls maxPower 1000)
									(block Nil
										(setq gCost 10000)
										(setq gItem (itmCreate &it100MWReactor; 1))
										)
										
								(setq gItem Nil)
								)
								
							; Install screen
							(if gItem
								(scrShowScreen gScreen "&dsInstallSpecificDevice;")
								(scrShowPane gScreen "NoReactorUpgrade")
								)
							)
					</Action>

					<Action name="Undock" cancel="1" key="U">
						<Exit/>
					</Action>

				</Actions>

			</Default>
				
			<NoReactorUpgrade
					desc=	"The technology required to upgrade your reactor is not available at this station.">
					
				<Actions>
					<Action name="Continue" key="C" default="1" cancel="1">
						<ShowPane pane="Default"/>
					</Action>
				</Actions>
			</NoReactorUpgrade>

		</Panes>

	</DockScreen>

	<Image UNID="&rsCommonwealthSlumsImage;"	bitmap="Resources\CommonwealthSlums.jpg" bitmask="Resources\CommonwealthSlumsMask.bmp" backColor="0x00000000" loadOnUse="true"/>

</TranscendenceModule>
